# Template file for 'ObjFW'
pkgname=ObjFW
version=1.0.9
revision=1
build_style=gnu-configure
hostmakedepends="clang doxygen"
makedepends="openssl-devel"
short_desc="Portable framework for the Objective-C language"
maintainer="Jason Barmparesos <github@jasonb.dev>"
license="GPL-2.0-only,GPL-3.0-only,QPL-1.0"
homepage="https://objfw.nil.im"
changelog="https://objfw.nil.im/file?name=ChangeLog&ci=trunk"
distfiles="https://objfw.nil.im/downloads/objfw-${version}.tar.gz"
checksum=2706af1dd584099495c68465843c4d49e613fecc57a39b565a7262ec5fae9474

do_configure() {
	if [ -n "${XBPS_CROSS_TRIPLET}" ]; then
		./configure ${configure_args} \
			OBJC="clang --target=${XBPS_CROSS_TRIPLET}"
	else
		./configure ${configure_args} OBJC=clang
	fi
}

do_build() {
	make ${makejobs}
	make docs
}

post_install() {
	vmkdir usr/share/doc/objfw
	vcopy "docs/*" usr/share/doc/objfw

	# See https://github.com/SerenityOS/serenity/issues/20274
	if [ -n "${XBPS_CROSS_TRIPLET}" ]; then
		mv "${DESTDIR}/usr/bin/${XBPS_CROSS_TRIPLET}-objfw-compile" ${DESTDIR}/usr/bin/objfw-compile
		mv "${DESTDIR}/usr/bin/${XBPS_CROSS_TRIPLET}-objfw-config" ${DESTDIR}/usr/bin/objfw-config
		mv "${DESTDIR}/usr/bin/${XBPS_CROSS_TRIPLET}-objfw-embed" ${DESTDIR}/usr/bin/objfw-embed
	fi
}

ObjFW-devel_package() {
	short_desc+=" - development files and utilities"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove "usr/bin/objfw-*"
	}
}

ObjFW-doc_package() {
	short_desc+=" - developer documentation"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share/doc
	}
}
